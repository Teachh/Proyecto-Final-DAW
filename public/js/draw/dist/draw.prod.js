"use strict";document.addEventListener("DOMContentLoaded",function(){var t=!1;points=[],lines=[];var a=null,o=[],s=[];function n(e,t,n){var r=document.querySelector("#color-picker").value,o=document.querySelector("#thickness-picker").value;if(n){var s=points[points.length-1],i=a.append("line").attr("x1",s.attr("cx")).attr("y1",s.attr("cy")).attr("x2",e).attr("y2",t).attr("stroke-width",2*o).style("stroke",r);lines.push(i)}var l=a.append("circle").attr("cx",e).attr("cy",t).attr("r",o).style("fill",r);points.push(l)}(a=d3.select("#draw").attr("height","45rem").attr("width","100%")).on("mousedown",function(){t=!0;var e=d3.mouse(this);n(e[0],e[1],!1)}),a.on("mouseup",function(){o.push(lines.length),s.push(points.length),console.log(lines),console.log(points),t=!1}),d3.select("#saveButton").on("click",function(){!function(e,t,n,r,o){var s="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),i=document.createElement("canvas"),l=i.getContext("2d");i.width=t,i.height=n;var a=new Image;a.onload=function(){l.clearRect(0,0,t,n),l.drawImage(a,0,0,t,n),i.toBlob(function(e){var t=Math.round(e.length/1024)+" KB";o&&o(e,t)})},a.src=s}(function(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink"),function(e,t){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=e;var r=t.hasChildNodes()?t.children[0]:null;t.insertBefore(n,r)}(function(e){var t=[];t.push("#"+e.id);for(var n=0;n<e.classList.length;n++)h("."+e.classList[n],t)||t.push("."+e.classList[n]);for(var r=e.getElementsByTagName("*"),o=0;o<r.length;o++){var s=r[o].id;h("#"+s,t)||t.push("#"+s);var i=r[o].classList;for(n=0;n<i.length;n++)h("."+i[n],t)||t.push("."+i[n])}var l="";for(o=0;o<document.styleSheets.length;o++){var a=document.styleSheets[o];try{if(!a.cssRules)continue}catch(e){if("SecurityError"!==e.name)throw e;continue}for(var c=a.cssRules,u=0;u<c.length;u++)h(c[u].selectorText,t)&&(l+=c[u].cssText)}return l;function h(e,t){return-1!==t.indexOf(e)}}(e),e);var t=(new XMLSerializer).serializeToString(e);return t=(t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}(a.node()),600,600,0,function(e,t){saveAs(e,"D3 vis exported to PNG.png")})}),a.on("mousemove",function(){if(t){var e=d3.mouse(this);n(e[0],e[1],!0)}}),document.querySelector("#erase").onclick=function(){for(var e=0;e<points.length;e++)points[e].remove();for(var t=0;t<lines.length;t++)lines[t].remove();points=[],lines=[]},document.querySelector("#undo").onclick=function(){if(null==s[s.length-2]){for(var e=0;e<points.length;e++)points[e].remove();for(var t=0;t<lines.length;t++)lines[t].remove();points=[],lines=[]}for(var n=s[s.length-2];n<s[s.length-1];n++)points[n].remove();for(var r=o[o.length-2];r<o[o.length-1];r++)lines[r].remove();s.pop(),o.pop()}});